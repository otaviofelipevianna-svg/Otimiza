<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Otimiza CRM - Online</title>
    
    <!-- Tailwind CSS (Visual) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel (Para processar o React) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Ajustes para Mobile */
        .mobile-card { transition: transform 0.2s; }
        .mobile-card:active { transform: scale(0.98); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            LayoutDashboard, Users, ShoppingBag, CreditCard, Wallet, 
            Plus, Trash2, Edit2, TrendingUp, CheckCircle, Clock, 
            MessageCircle, Play, Settings, LogOut, Lock, User, 
            WifiOff, Menu, X, Save
        } from 'https://esm.sh/lucide-react@0.292.0';

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { 
            getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot 
        } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { 
            getAuth, signInAnonymously, onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

        // --- CONFIGURAÇÃO (Sincronização na Nuvem) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDQ8ggMxe09e6qf92B-1lv3A6gCP-J33Js",
            authDomain: "otimiza-9e42f.firebaseapp.com",
            projectId: "otimiza-9e42f",
            storageBucket: "otimiza-9e42f.firebasestorage.app",
            messagingSenderId: "482070105168",
            appId: "1:482070105168:web:cf8aae2f888946f196d555",
            measurementId: "G-HNWMPJ468D"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const APP_ID = 'otimiza_crm_v1';

        // --- COMPONENTES VISUAIS ---
        const Card = ({ title, value, subtext, icon: Icon, trend }) => (
            <div className="bg-white p-5 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between h-full">
                <div className="flex justify-between items-start mb-2">
                    <p className="text-gray-500 text-xs font-bold uppercase tracking-wider">{title}</p>
                    <div className={`p-2 rounded-lg ${trend === 'up' ? 'bg-green-50 text-green-600' : trend === 'down' ? 'bg-red-50 text-red-600' : 'bg-black text-white'}`}>
                        <Icon size={20} />
                    </div>
                </div>
                <div>
                    <h3 className="text-2xl font-bold text-gray-900">{value}</h3>
                    {subtext && <p className={`text-xs mt-1 ${trend === 'up' ? 'text-green-600' : trend === 'down' ? 'text-red-600' : 'text-gray-400'}`}>{subtext}</p>}
                </div>
            </div>
        );

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
            const baseStyle = "px-4 py-3 md:py-2 rounded-lg font-medium transition-all flex items-center justify-center gap-2 active:scale-95 touch-manipulation";
            const variants = {
                primary: "bg-black text-white hover:bg-gray-800 disabled:bg-gray-400",
                secondary: "bg-gray-100 text-gray-700 hover:bg-gray-200",
                danger: "bg-red-50 text-red-600 hover:bg-red-100",
                outline: "border border-gray-300 text-gray-700 hover:bg-gray-50"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end md:items-center justify-center z-50 p-0 md:p-4 animate-in fade-in duration-200">
                    <div className="bg-white w-full md:rounded-2xl rounded-t-2xl md:max-w-lg shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                        <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50 sticky top-0 z-10">
                            <h2 className="text-lg font-bold text-gray-900">{title}</h2>
                            <button onClick={onClose} className="p-2 bg-gray-200 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors"><X size={18}/></button>
                        </div>
                        <div className="p-6 overflow-y-auto">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const StatusBadge = ({ status }) => {
            const styles = {
                'Negociação': 'bg-gray-100 text-gray-600 border-gray-200',
                'Em Processo': 'bg-blue-50 text-blue-600 border-blue-100',
                'Concluído': 'bg-green-50 text-green-600 border-green-100'
            };
            const Icon = { 'Negociação': MessageCircle, 'Em Processo': Clock, 'Concluído': CheckCircle }[status] || MessageCircle;
            return (
                <span className={`px-2 py-1 rounded-md text-[10px] uppercase font-bold border flex items-center gap-1 w-fit ${styles[status]}`}>
                    <Icon size={10} /> {status}
                </span>
            );
        };

        // --- APLICAÇÃO ---
        function App() {
            // Auth & Conexão
            const [firebaseUser, setFirebaseUser] = useState(null);
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [authError, setAuthError] = useState('');

            // Login do App
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [loginForm, setLoginForm] = useState({ user: '', pass: '' });
            const [loginStatus, setLoginStatus] = useState({ msg: '', type: '' });

            // Dados
            const [users, setUsers] = useState([]);
            const [clients, setClients] = useState([]);
            const [purchases, setPurchases] = useState([]);
            const [subscriptions, setSubscriptions] = useState([]);
            const [withdrawals, setWithdrawals] = useState([]);

            const [activeTab, setActiveTab] = useState('dashboard');

            // Modais e Forms
            const [modals, setModals] = useState({ client: false, purchase: false, sub: false, withdrawal: false });
            const [editingId, setEditingId] = useState(null);
            
            const initialForms = {
                client: { name: '', segment: '', works: '', charged: '', received: '', status: 'Negociação' },
                purchase: { item: '', price: '', installments: '1', category: 'Equipamento' },
                sub: { name: '', price: '' },
                withdrawal: { name: '', amount: '', description: '' },
                user: { user: '', pass: '' }
            };
            const [forms, setForms] = useState(initialForms);

            // --- INICIALIZAÇÃO FIREBASE ---
            useEffect(() => {
                const init = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (err) {
                        console.error("Erro auth:", err);
                        setAuthError("Erro de conexão. Verifique se a Autenticação Anônima está ativada no Firebase Console.");
                    }
                };
                init();
                
                const unsubAuth = onAuthStateChanged(auth, (u) => setFirebaseUser(u));
                
                window.addEventListener('online', () => setIsOnline(true));
                window.addEventListener('offline', () => setIsOnline(false));

                return () => {
                    unsubAuth();
                    window.removeEventListener('online', () => {});
                    window.removeEventListener('offline', () => {});
                };
            }, []);

            // --- SINCRONIZAÇÃO DE DADOS ---
            useEffect(() => {
                if (!firebaseUser) return;

                // Função auxiliar para ouvir coleções
                const listen = (colName, setter) => {
                    const q = collection(db, 'artifacts', APP_ID, 'public', 'data', colName);
                    return onSnapshot(q, (snap) => {
                        const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                        setter(data);
                    }, (err) => console.error(`Erro em ${colName}:`, err));
                };

                const unsubs = [
                    listen('users', (data) => {
                        setUsers(data);
                        // Se não houver usuários, cria o Admin padrão automaticamente
                        if (data.length === 0) {
                            addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'users'), {
                                user: 'Admin', pass: 'Admin', role: 'admin', createdAt: Date.now()
                            });
                        }
                    }),
                    listen('clients', setClients),
                    listen('purchases', setPurchases),
                    listen('subscriptions', setSubscriptions),
                    listen('withdrawals', setWithdrawals)
                ];

                return () => unsubs.forEach(u => u());
            }, [firebaseUser]);

            // --- LOGIN DO SISTEMA ---
            const handleLogin = (e) => {
                e.preventDefault();
                if (!isOnline && users.length === 0) {
                    setLoginStatus({ msg: 'Sem internet para verificar login.', type: 'error' });
                    return;
                }

                const found = users.find(u => 
                    u.user.trim().toLowerCase() === loginForm.user.trim().toLowerCase() && 
                    u.pass === loginForm.pass
                );

                if (found) {
                    setLoginStatus({ msg: 'Acesso Permitido', type: 'success' });
                    setTimeout(() => {
                        setIsAuthenticated(true);
                        setCurrentUser(found);
                        setLoginStatus({ msg: '', type: '' });
                    }, 800);
                } else {
                    setLoginStatus({ msg: 'Acesso Negado', type: 'error' });
                }
            };

            // --- CRUD GENÉRICO ---
            const handleSave = async (type) => {
                if (!firebaseUser) return alert("Sem conexão com o banco de dados.");
                
                const collectionName = type + 's'; // clients, purchases...
                const formKey = type; // client, purchase...
                let payload = { ...forms[formKey] };
                
                // Conversões numéricas
                if (payload.price) payload.price = Number(payload.price);
                if (payload.amount) payload.amount = Number(payload.amount);
                if (payload.charged) payload.charged = Number(payload.charged);
                if (payload.received) payload.received = Number(payload.received);
                
                // Data default para retiradas
                if (type === 'withdrawal' && !payload.date) payload.date = new Date().toLocaleDateString('pt-BR');

                const colRef = collection(db, 'artifacts', APP_ID, 'public', 'data', collectionName);

                try {
                    if (editingId) {
                        await updateDoc(doc(colRef, editingId), payload);
                    } else {
                        await addDoc(colRef, { ...payload, createdAt: Date.now(), createdBy: currentUser.user });
                    }
                    closeModals();
                } catch (e) {
                    console.error(e);
                    alert("Erro ao salvar. Verifique sua internet.");
                }
            };

            const handleDelete = async (type, id) => {
                if (confirm('Tem certeza?')) {
                    try {
                        await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', type + 's', id));
                    } catch (e) { console.error(e); }
                }
            };

            // --- GERENCIAMENTO DE USUÁRIOS ---
            const handleAddUser = async () => {
                if (!forms.user.user || !forms.user.pass) return alert("Preencha tudo.");
                const exists = users.some(u => u.user.toLowerCase() === forms.user.user.toLowerCase());
                if (exists) return alert("Usuário já existe.");

                try {
                    await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'users'), {
                        ...forms.user, createdAt: Date.now()
                    });
                    setForms({...forms, user: { user: '', pass: '' }});
                    alert("Usuário criado! Agora ele pode logar em qualquer dispositivo.");
                } catch (e) { console.error(e); }
            };

            // Helpers
            const openModal = (type, item = null) => {
                if (item) {
                    setEditingId(item.id);
                    setForms(prev => ({ ...prev, [type]: item }));
                } else {
                    setEditingId(null);
                    setForms(prev => ({ ...prev, [type]: initialForms[type] }));
                }
                setModals(prev => ({ ...prev, [type]: true }));
            };

            const closeModals = () => {
                setModals({ client: false, purchase: false, sub: false, withdrawal: false });
                setEditingId(null);
            };

            const formatBRL = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0);

            // Cálculos
            const totalReceived = clients.reduce((acc, c) => acc + (c.received || 0), 0);
            const totalExpenses = purchases.reduce((acc, i) => acc + (i.price || 0), 0) + 
                                  withdrawals.reduce((acc, i) => acc + (i.amount || 0), 0) +
                                  subscriptions.reduce((acc, i) => acc + (i.price || 0), 0);
            const netProfit = totalReceived - totalExpenses;


            // --- TELA DE LOGIN ---
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-black flex flex-col items-center justify-center p-6">
                        <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 fade-in">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-16 h-16 bg-black rounded-full mb-4 shadow-lg border-4 border-gray-100">
                                    <Lock className="text-white" size={32} />
                                </div>
                                <h1 className="text-2xl font-bold text-gray-900">Otimiza CRM</h1>
                                <p className="text-sm text-gray-500 mt-2">Gestão Segura na Nuvem</p>
                            </div>

                            <form onSubmit={handleLogin} className="space-y-5">
                                <div>
                                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1 ml-1">Usuário</label>
                                    <div className="relative">
                                        <User className="absolute left-3 top-3.5 text-gray-400" size={18} />
                                        <input 
                                            type="text" 
                                            value={loginForm.user}
                                            onChange={e => setLoginForm({...loginForm, user: e.target.value})}
                                            className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-black focus:border-transparent transition-all outline-none"
                                            placeholder="Seu login"
                                        />
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-700 uppercase mb-1 ml-1">Senha</label>
                                    <div className="relative">
                                        <Lock className="absolute left-3 top-3.5 text-gray-400" size={18} />
                                        <input 
                                            type="password" 
                                            value={loginForm.pass}
                                            onChange={e => setLoginForm({...loginForm, pass: e.target.value})}
                                            className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-black focus:border-transparent transition-all outline-none"
                                            placeholder="Sua senha"
                                        />
                                    </div>
                                </div>

                                {loginStatus.msg && (
                                    <div className={`p-3 rounded-lg text-sm text-center font-medium ${loginStatus.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                        {loginStatus.msg}
                                    </div>
                                )}

                                <button type="submit" disabled={!isOnline && users.length === 0} className="w-full bg-black text-white font-bold py-3.5 rounded-lg hover:bg-gray-800 transition-transform active:scale-95 disabled:opacity-50 shadow-lg">
                                    {isOnline ? 'Entrar no Sistema' : 'Conectando...'}
                                </button>
                            </form>
                            
                            {!isOnline && (
                                <p className="mt-4 text-xs text-center text-red-500 flex items-center justify-center gap-1">
                                    <WifiOff size={12}/> Sem internet. Conecte-se para sincronizar.
                                </p>
                            )}
                            {authError && <p className="mt-4 text-xs text-center text-red-600 bg-red-50 p-2 rounded">{authError}</p>}
                        </div>
                    </div>
                );
            }

            // --- TELA PRINCIPAL ---
            return (
                <div className="flex flex-col md:flex-row h-screen bg-gray-50 fade-in overflow-hidden">
                    
                    {/* Sidebar Desktop */}
                    <aside className="hidden md:flex w-64 bg-black text-white flex-col shadow-2xl z-20">
                        <div className="p-6 flex flex-col items-center border-b border-gray-800">
                             <div className="text-2xl font-bold tracking-tighter flex items-center gap-1">
                                Otimiza<Play className="fill-white" size={20}/>
                            </div>
                            <p className="text-[10px] text-gray-400 uppercase tracking-widest mt-1">Produtora de Vídeo</p>
                        </div>
                        <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                            {[
                                { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
                                { id: 'clients', label: 'Projetos', icon: Users },
                                { id: 'purchases', label: 'Compras', icon: ShoppingBag },
                                { id: 'subscriptions', label: 'Assinaturas', icon: CreditCard },
                                { id: 'team', label: 'Retiradas', icon: Wallet },
                                { id: 'settings', label: 'Configurações', icon: Settings },
                            ].map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all ${activeTab === item.id ? 'bg-white text-black font-bold' : 'text-gray-400 hover:text-white hover:bg-gray-900'}`}>
                                    <item.icon size={18} /> {item.label}
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-gray-800">
                             <div className="flex items-center gap-2 mb-3 px-2">
                                <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <span className="text-xs text-gray-400">Online</span>
                             </div>
                             <div className="text-xs text-gray-500 mb-2 px-2">Logado como: <strong className="text-white">{currentUser.user}</strong></div>
                             <button onClick={() => window.location.reload()} className="w-full flex items-center gap-2 px-3 py-2 text-xs text-red-300 hover:bg-red-900/20 rounded">
                                <LogOut size={14} /> Sair
                             </button>
                        </div>
                    </aside>

                    {/* Mobile Header & Content */}
                    <main className="flex-1 flex flex-col h-full overflow-hidden relative">
                        {/* Header Mobile */}
                        <header className="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center z-10 md:px-8">
                            <div>
                                <h1 className="text-xl font-bold text-gray-900 capitalize flex items-center gap-2">
                                    {activeTab === 'dashboard' ? 'Visão Geral' : activeTab === 'clients' ? 'Projetos' : activeTab === 'settings' ? 'Ajustes' : activeTab}
                                </h1>
                            </div>
                            <div className="flex items-center gap-3">
                                {!isOnline && <WifiOff className="text-red-500" size={18}/>}
                                <div className="h-8 w-8 bg-black rounded-full flex items-center justify-center text-white font-bold text-xs shadow-md">
                                    {currentUser.user.substring(0,2).toUpperCase()}
                                </div>
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8">
                            <div className="max-w-6xl mx-auto space-y-6">
                                
                                {/* DASHBOARD */}
                                {activeTab === 'dashboard' && (
                                    <>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <Card title="Faturamento" value={formatBRL(totalReceived)} icon={TrendingUp} trend="up" />
                                            <Card title="Despesas" value={formatBRL(totalExpenses)} icon={ShoppingBag} trend="down" />
                                            <Card title="Lucro Líquido" value={formatBRL(netProfit)} icon={Wallet} trend={netProfit >= 0 ? 'up' : 'down'} />
                                            <Card title="Custo Fixo/Mês" value={formatBRL(subscriptions.reduce((acc, i) => acc + (i.price || 0), 0))} icon={CreditCard} />
                                        </div>
                                        
                                        <div className="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                                            <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2"><Clock size={18}/> Projetos Recentes</h3>
                                            {clients.length === 0 ? <p className="text-gray-400 text-sm">Nenhum projeto ainda.</p> : (
                                                <div className="space-y-3">
                                                    {clients.slice(-5).reverse().map(c => (
                                                        <div key={c.id} className="flex justify-between items-center border-b border-gray-50 pb-2 last:border-0">
                                                            <div>
                                                                <p className="font-bold text-sm">{c.name}</p>
                                                                <StatusBadge status={c.status} />
                                                            </div>
                                                            <span className="font-bold text-green-600 text-sm">{formatBRL(c.received)}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </>
                                )}

                                {/* LISTAS (GENÉRICAS PARA FICAR LIMPO) */}
                                {['clients', 'purchases', 'subscriptions', 'withdrawals'].includes(activeTab) && (
                                    <div className="space-y-4">
                                        <div className="flex justify-end sticky top-0 z-10 bg-gray-50 pb-2">
                                            <Button onClick={() => openModal(activeTab.slice(0, -1))}><Plus size={18}/> Adicionar</Button>
                                        </div>
                                        
                                        {/* Grid de Cards (Mobile Friendly) */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            {(activeTab === 'clients' ? clients : activeTab === 'purchases' ? purchases : activeTab === 'subscriptions' ? subscriptions : withdrawals).map(item => (
                                                <div key={item.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col justify-between mobile-card">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <h3 className="font-bold text-gray-900">{item.name || item.item}</h3>
                                                            <p className="text-xs text-gray-500">{item.segment || item.category || item.description || 'Assinatura'}</p>
                                                        </div>
                                                        {activeTab === 'clients' && <StatusBadge status={item.status} />}
                                                    </div>
                                                    
                                                    <div className="flex justify-between items-end mt-2">
                                                        <div>
                                                            {activeTab === 'clients' && <p className="text-xs text-gray-400">Recebido</p>}
                                                            <p className={`font-bold ${activeTab === 'clients' ? 'text-green-600' : 'text-red-600'}`}>
                                                                {activeTab === 'clients' ? formatBRL(item.received) : `-${formatBRL(item.price || item.amount)}`}
                                                            </p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => openModal(activeTab.slice(0, -1), item)} className="p-2 bg-gray-100 rounded-lg text-gray-600 hover:text-blue-600"><Edit2 size={16}/></button>
                                                            <button onClick={() => handleDelete(activeTab.slice(0, -1), item.id)} className="p-2 bg-red-50 rounded-lg text-red-500 hover:bg-red-100"><Trash2 size={16}/></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            {(activeTab === 'clients' ? clients : withdrawals).length === 0 && <p className="col-span-full text-center text-gray-400 py-10">Nenhum item encontrado.</p>}
                                        </div>
                                    </div>
                                )}

                                {/* SETTINGS */}
                                {activeTab === 'settings' && (
                                    <div className="space-y-6 max-w-lg mx-auto">
                                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                            <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Users size={20}/> Gerenciar Equipe</h3>
                                            <p className="text-xs text-gray-500 mb-4">Adicione usuários para que seus sócios possam acessar o CRM de seus próprios celulares.</p>
                                            
                                            <div className="bg-gray-50 p-4 rounded-lg space-y-3">
                                                <input type="text" placeholder="Novo Login" value={forms.user.user} onChange={e => setForms({...forms, user: {...forms.user, user: e.target.value}})} className="w-full p-2 border rounded text-sm"/>
                                                <input type="text" placeholder="Nova Senha" value={forms.user.pass} onChange={e => setForms({...forms, user: {...forms.user, pass: e.target.value}})} className="w-full p-2 border rounded text-sm"/>
                                                <Button onClick={handleAddUser} className="w-full justify-center">Criar Acesso</Button>
                                            </div>

                                            <div className="mt-6 space-y-2">
                                                <p className="text-xs font-bold uppercase text-gray-400">Usuários Ativos</p>
                                                {users.map(u => (
                                                    <div key={u.id} className="flex justify-between items-center p-3 border rounded-lg bg-white">
                                                        <div className="flex items-center gap-3">
                                                            <div className="h-8 w-8 bg-gray-200 rounded-full flex items-center justify-center text-xs font-bold text-gray-600">
                                                                {u.user.substring(0,2).toUpperCase()}
                                                            </div>
                                                            <span className="font-bold text-sm">{u.user}</span>
                                                        </div>
                                                        {users.length > 1 && (
                                                            <button onClick={() => handleDelete('user', u.id)} className="text-red-400 hover:text-red-600"><Trash2 size={16}/></button>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="text-center pb-8">
                                            <button onClick={() => window.location.reload()} className="text-red-500 text-sm font-medium">Sair do App</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Mobile Bottom Nav */}
                        <div className="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around p-2 pb-safe z-20 shadow-2xl">
                            {['dashboard', 'clients', 'purchases', 'team', 'settings'].map(id => {
                                const Icon = { dashboard: LayoutDashboard, clients: Users, purchases: ShoppingBag, team: Wallet, settings: Settings }[id];
                                return (
                                    <button key={id} onClick={() => setActiveTab(id)} className={`p-3 rounded-xl flex flex-col items-center gap-1 ${activeTab === id ? 'text-black' : 'text-gray-400'}`}>
                                        <Icon size={24} strokeWidth={activeTab === id ? 2.5 : 2} />
                                    </button>
                                );
                            })}
                        </div>
                    </main>

                    {/* --- MODAIS DE CADASTRO --- */}
                    <Modal isOpen={modals.client} onClose={closeModals} title={editingId ? "Editar Projeto" : "Novo Projeto"}>
                        <div className="space-y-4">
                            <input className="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white transition-colors" placeholder="Nome do Cliente" value={forms.client.name} onChange={e => setForms({...forms, client: {...forms.client, name: e.target.value}})} />
                            <input className="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white transition-colors" placeholder="Segmento" value={forms.client.segment} onChange={e => setForms({...forms, client: {...forms.client, segment: e.target.value}})} />
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="text-xs text-gray-500 font-bold ml-1">Valor Cobrado</label>
                                    <input type="number" className="w-full border p-3 rounded-lg" placeholder="0,00" value={forms.client.charged} onChange={e => setForms({...forms, client: {...forms.client, charged: e.target.value}})} />
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500 font-bold ml-1">Valor Recebido</label>
                                    <input type="number" className="w-full border p-3 rounded-lg text-green-600 font-bold" placeholder="0,00" value={forms.client.received} onChange={e => setForms({...forms, client: {...forms.client, received: e.target.value}})} />
                                </div>
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 font-bold ml-1">Status</label>
                                <select className="w-full border p-3 rounded-lg bg-white" value={forms.client.status} onChange={e => setForms({...forms, client: {...forms.client, status: e.target.value}})}>
                                    <option>Negociação</option><option>Em Processo</option><option>Concluído</option>
                                </select>
                            </div>
                            <Button onClick={() => handleSave('client')} className="w-full justify-center">Salvar</Button>
                        </div>
                    </Modal>

                    <Modal isOpen={modals.purchase} onClose={closeModals} title="Compra">
                        <div className="space-y-4">
                            <input className="w-full border p-3 rounded-lg" placeholder="Item Comprado" value={forms.purchase.item} onChange={e => setForms({...forms, purchase: {...forms.purchase, item: e.target.value}})} />
                            <div className="grid grid-cols-2 gap-3">
                                <input type="number" className="w-full border p-3 rounded-lg" placeholder="Preço Total" value={forms.purchase.price} onChange={e => setForms({...forms, purchase: {...forms.purchase, price: e.target.value}})} />
                                <select className="w-full border p-3 rounded-lg" value={forms.purchase.category} onChange={e => setForms({...forms, purchase: {...forms.purchase, category: e.target.value}})}>
                                    <option>Equipamento</option><option>Software</option><option>Outros</option>
                                </select>
                            </div>
                            <Button onClick={() => handleSave('purchase')} className="w-full justify-center">Salvar</Button>
                        </div>
                    </Modal>

                     <Modal isOpen={modals.sub} onClose={closeModals} title="Assinatura">
                        <div className="space-y-4">
                            <input className="w-full border p-3 rounded-lg" placeholder="Serviço (Ex: Adobe)" value={forms.sub.name} onChange={e => setForms({...forms, sub: {...forms.sub, name: e.target.value}})} />
                            <input type="number" className="w-full border p-3 rounded-lg" placeholder="Valor Mensal" value={forms.sub.price} onChange={e => setForms({...forms, sub: {...forms.sub, price: e.target.value}})} />
                            <Button onClick={() => handleSave('sub')} className="w-full justify-center">Salvar</Button>
                        </div>
                    </Modal>

                     <Modal isOpen={modals.withdrawal} onClose={closeModals} title="Retirada">
                        <div className="space-y-4">
                            <input className="w-full border p-3 rounded-lg" placeholder="Quem recebeu?" value={forms.withdrawal.name} onChange={e => setForms({...forms, withdrawal: {...forms.withdrawal, name: e.target.value}})} />
                            <input type="number" className="w-full border p-3 rounded-lg text-red-600 font-bold" placeholder="Valor" value={forms.withdrawal.amount} onChange={e => setForms({...forms, withdrawal: {...forms.withdrawal, amount: e.target.value}})} />
                            <input className="w-full border p-3 rounded-lg" placeholder="Motivo" value={forms.withdrawal.description} onChange={e => setForms({...forms, withdrawal: {...forms.withdrawal, description: e.target.value}})} />
                            <Button onClick={() => handleSave('withdrawal')} className="w-full justify-center">Salvar</Button>
                        </div>
                    </Modal>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
